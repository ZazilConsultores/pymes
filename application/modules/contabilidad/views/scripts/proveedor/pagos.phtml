<?php 
	$saldo;
	$formulario = $this->formulario;
	$divisaDAO = new Contabilidad_DAO_Divisa;
	$divisas = $divisaDAO->obtenerDivisas();
	$bancosDAO = new Inventario_DAO_Banco;
	$bancos = $bancosDAO->obtenerBancos();
	$facturasxp = $this->facturasxp;
	$conceptoPagos =array("AN"=>"ANTICIPO", "LI"=>"LIQUIDADO","PA"=>"PAGO");
	$formasPago = array('CH'=>'CHEQUE','DE'=>'DEPOSITO','EF'=>'EFECTIVO','SP'=>'SPEI', 'DO'=>'DOCUMENTO');
?>
<section class="panel panel-success">
	<div class="panel-heading">
		<h3 class="panel-title">Ingresa datos para busqueda factura por pagar:</h3>
	</div>
	<div class="panel-body">
		<?php  echo $this->formulario; ?>
	</div>
</section>

	<section class="panel panel-success">
		<div class="panel-heading">
			<h3 class="panel-title">Cuentas por pagar.</h3>
		</div>
		<div class="panel-body">
			<table id="detalleCxP" class="table table-striped table-condensed">
				<thead>
					<th>IdSucursal</th>
					<th>IdProveedor</th>
					<th>NÃºmero factura</th>
					<th>Fecha </th>
					<th>$Total</th>
				</thead>
				<tbody>
					<?php foreach($facturasxp as $facturaxp): ?>
						<tr>
							<td><?php echo $facturaxp->getIdSucursal(); ?></td>
							<td><?php echo $facturaxp->getIdCoP(); ?></td>
							<td id="idFactura" ><?php echo $facturaxp->getNumeroFactura(); ?></td>
							<td><?php echo $facturaxp->getFechaFactura(); ?></td>
							<td><?php echo $facturaxp->getTotal(); ?></td>
							<td>
								<a class="btn btn-warning" href="<?php echo $this->url(array("module"=>"contabilidad","controller"=>"proveedor", "action"=>"aplicarpago","idFactura"=>$facturaxp->getIdFactura()), null, true); ?>">
									<span class="glyphicon glyphicon-pencil"></span>Pago
								</a>
							</td>
							<!--<td><button type="button" class="btn btn-info">
								<span class="glyphicon glyphicon-pencil"></span> Registrar un pago. 
							</button></td>-->
							<td><button   type="button" class="btn btn-primary btnBusqueda" id="nomina" data-toggle="modal" data-target="#msgConfirmN" >
								<span class="glyphicon glyphicon-pencil"></span> Registara una nomina de Credito.
							</button></td>
						</tr>
						<?php endforeach; ?>
				</tbody>
			</table>
		</div>
	</section>
	

<section class="panel panel-info">
	<div class="panel-heading">
		<h3 class="panel-title">Registrar</h3>
	</div>
	<div class="panel-body">
		<table id="tableDetails" class="table table-striped table-condensed">
			<thead>
				<th>Pago en</th>
				<th>Pago $</th>
				<th>Fecha pago</th>
				<th>Concepto pago</th>
			</thead>
			<tbody>
				
			</tbody>
		</table>
	</div>
</section>
<div class="modal fade" id="msgConfirm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title">Cuentas por pagar.</h4>
			</div>
			<div class="modal-body">
						
				<tr>
					<label id="factura">Factura</label>
					<input type="text" id="factura" class="form-control"/>
					<label for="fecha">Fecha</label>
  					<input type="text" id="fechaInicial" class="form-control"/>
  					<label for="fecha">Pago $</label>
  					<input type="text" id="importePago" class="form-control"/>
  					<td>Seleccione Divisa</td>
  						<td>
  							<select id="idDivisa" class="form-control">
  								<?php foreach ($divisas as $divisa) : ?>
									<option value="<?php echo $divisa->getIdDivisa(); ?>"><?php echo $divisa->getDescripcion(); ?></option>
								<?php endforeach; ?>
							</select>
						</td>
  					<td>Concepto de Pago</td>
  						<td>
  							<select id="conceptoPago" class="form-control">
  								<?php foreach ($conceptoPagos as $key => $value) : ?>
									<option value="<?php echo $key; ?>"><?php echo $value; ?></option>
								<?php endforeach; ?>
							</select>
						</td>
					<td>Forma de Pago</td>
  						<td>
  							<select id="formaPago" class="form-control">
  								<?php foreach ($formasPago as $key => $value) : ?>
									<option value="<?php echo $key; ?>"><?php echo $value; ?></option>
								<?php endforeach; ?>
							</select>
						</td>
  					<td>Seleccione Banco</td>
  						<td>
  							<select id="idBanco" class="form-control">
  								<?php foreach ($bancos as $banco) : ?>
									<option value="<?php echo $banco->getIdBanco(); ?>"><?php echo $banco->getBanco(); ?></option>
								<?php endforeach; ?>
							</select>
						</td>
  					<label for="fecha">Numero de referencia</label>
  					<input type="text" id="numeroReferencia" class="form-control"/>
				</tr>
			</div>
			<div class="modal-footer">
				<button id="registrarPago" type="button" class="btn btn-success" data-dismiss="modal">
					<span class="glyphicon glyphicon-ok"></span>  Registrar.
				</button>	
				<button type="button" class="btn btn-danger" data-dismiss="modal">
					<span class="glyphicon glyphicon-close"></span> Cancelar
				</button>
			</div>
		</div>
	</div>
</div>
<!--Nota de credito !-->
<div class="modal fade" id="msgConfirmN" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title">Cuentas por pagar.</h4>
			</div>
			<div class="modal-body">
				<tr>
					<label for="fecha">Fecha</label>
  					<input type="text" id="fechaInicial" class="form-control"/>
  					<label for="fecha">Pago $</label>
  					<input type="text" id="importePago" class="form-control"/>
  					<td>Seleccione Divisa</td>
  						<td>
  							<select id="idDivisa" class="form-control">
  								<?php foreach ($divisas as $divisa) : ?>
									<option value="<?php echo $divisa->getIdDivisa(); ?>"><?php echo $divisa->getDescripcion(); ?></option>
								<?php endforeach; ?>
							</select>
						</td>
				</tr>
			</div>
			<div class="modal-footer">
				<button id="registrarPago" type="button" class="btn btn-success" data-dismiss="modal">
					<span class="glyphicon glyphicon-ok"></span>  Registrar.
				</button>
				<button type="button" class="btn btn-danger" data-dismiss="modal">
					<span class="glyphicon glyphicon-close"></span> Cancelar
				</button>
			</div>
		</div>
	</div>
</div>
<script>
$(document).ready(function(){
	console.log("ready");
	var url = window.location.origin + "/General/";
	
	$("select#idEmpresas").on('change', function(){
		var idEmpresa = $(this).val();
		if (idEmpresa !=0){
			var urlSucursal = url + "sistema/json/sucursales/idFiscales/" + this.value;
			console.log(urlSucursal);
			$.ajax({
				url: urlSucursal,
				dataType: "json",
				success: function (data){
					$("select#idSucursal").empty();
					$.each(data, function (i,item){
						$("select#idSucursal").append($("<option></option>").attr("value",data[i].idSucursal).text(data[i].nombreSucursal));
					});
				}
			});
		}
	});
	
	$("select#idSucursal").on('click', function(){
		var idSucursal = $(this).val();
		console.log(idSucursal);
		var urlBuscaxEmpresa = url + "contabilidad/json/buscafactura/idSucursal/" + this.value ;
		console.log(urlBuscaxEmpresa);
	});
	
	
	
	$("select#idCoP").on('change', function(){
		console.log("Boton Presionado");
		var idCoP = $(this).val();
		var urlConsultaxp = url + "contabilidad/json/pagos/idCoP/" +idCoP;
		console.log(urlConsultaxp);
	});	
	
	$("#submit").on('click', function(){
		var idCoP = $("#idCoP").val();
		var urlConsultaxp = url + "contabilidad/json/pagos/idCoP/" +idCoP;
		console.log(urlConsultaxp);
		$.ajax({
			url: urlConsultaxp,		
			dataType: "json",
			success: function(data) {
				var tbody = ("tabla#detallecxp");
				$.each(data,function(i,item){
					/*var anchorDetails = $('<a>').attr({'class':'btn btn-link'}).attr({'target':'_blank'}).attr({'href': url + "contabilidad/json/pagos/idCoP/"+item.idCoP});*/
						
						tbody.append($('<td>').append(item.idSucursal)).
						append($('<td>').append(item.idProveedor)).
						append($('<td>').append(item.numeroFolio))
						//append($('<td>').append(anchorDetails))*/
				});
			}	
		});
	});
	

	
	$("#registrarPago").on("click", function (){
		var idFactura = $("#numeroFactura").val();
		var fecha = $("#fechaInicial").val();
		console.log(fecha);
		
		var urlConsultaxp = url + "contabilidad/proveedor/aplicarpago/idFactura/" + idFactura;
		console.log(urlConsultaxp);
		/*$.ajax({
			url: urlConsultaxp,		
			dataType: "json",
			success: function(data) {
				var tbody = ("tabla#detallecxp");
				$.each(data,function(i,item){
					/*var anchorDetails = $('<a>').attr({'class':'btn btn-link'}).attr({'target':'_blank'}).attr({'href': url + "contabilidad/json/pagos/idCoP/"+item.idCoP});*/
						
						//tbody.append($('<td>').append(item.idSucursal)).
						//append($('<td>').append(item.idProveedor)).
						//append($('<td>').append(item.numeroFolio))
						//append($('<td>').append(anchorDetails))*/
				//});*/
			//}	*/
		//});*/
		
 		//var valores = [];
 		
 			/*var fecha = $("input[id^='fechaInicial']").val();
 			var importe = $("input[id^='importePago']").val();
 			var divisa = $("select[id^='idDivisa']").val();
 			var pago = $("select[id^='conceptoPago']").val();
 			var fpago = $("select[id^='formaPago']").val();
 			var banco = $("select[id^='idBanco']").val();
 			var referencia = $("input[id^='numeroReferencia']").val();
 			
 				console.log("fecha:"+fecha);
 				console.log("importe:"+importe);
 				console.log("divisa:"+divisa);
 				console.log("pago:"+pago);
 				console.log("formaPago:"+fpago);
 				console.log("banco:"+banco);
 				console.log("referencia:"+referencia);
 						
 				valores.push(new Valor(fecha, importe, divisa, pago, fpago, banco, referencia)); 
 			console.dir("Los valores son los siguientes:");
 			console.dir(valores);
 			/*var myString = JSON.stringify(valores);
 			
 			console.log(myString);
 			if ($("input#valores").val(myString)){
 				
 			};*/
 			
 			
	});
	function Valor(fecha, importe, divisa, pago, fpago, banco, referencia) {
		  this.fecha = fecha;
		  this.importe = importe;
		  this.divisa = divisa;
		  this.pago = pago;
		  this.fpago = fpago;
		  this.banco = banco;
		  this.referencia = referencia;
		}
		
	$("#total").on("click" ,function() {
		var saldo = 0;
		saldo = $("#total").text();
		console.log("click");
		console.log(saldo);
	});
	
	$("select#idProveedor").on('click', function (){
		var idProveedor = $(this).val();
		if(idProveedor != 0){
		
		}
	});
	
	$("input#numeroFactura").on('change', function(){
		$("button#btnPagosProveedor").removeAttr("disabled");
	});
	
	$("button#btnPagosProveedor").on('click', function(){
		console.log("click");
		var idSucursal = $("select#idSucursal").val();
		var idCoP = $("select#idCoP").val();
		var numFac = $("input#numeroFactura").val();
		
		console.log(idSucursal);
	
		/*var url = window.location.origin +contabilidad/impuestos/enlazarproducto/idProducto/" + producto + "/idImpuesto/" + impuesto;
	     console.log(url); sistema/json/sucursales/idFiscales/
	    var urlCuentasxp = url + "contabilidad/json/pagos/idSucursal/"+ idSucursal;*/
	    var urlCuentasxp = url + "contabilidad/json/pagos/idSucursal/" + idSucursal +"/idCoP/" + idCoP + "/numeroFactura/" + numFac;
	    console.log(urlCuentasxp); 
	});
	
});

function soloNumero()
	{
		if((event.keyCode < 48) || (event.keyCode > 57))
			event.returnValue = false;
	}
	
	
</script>